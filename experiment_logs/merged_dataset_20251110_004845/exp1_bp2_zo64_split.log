Using device: cuda
Logs will be stored in /home/polyu/pcllzy/zo_withbp/logs/exp1_bp2_zo64_split_20251110_004848
成功从本地加载tokenizer: /home/polyu/pcllzy/zo_withbp/tokenizer
Creating model: 200M
Description: 中小型模型，约200M参数，类似GPT-2 Small
Configuration:
  - Embedding dim: 768
  - Layers: 12
  - Attention heads: 12
  - Max position: 1024
  - Vocab size: 50258

Model created successfully!
Total parameters: 124,440,576 (124.44M)
Trainable parameters: 124,440,576 (124.44M)
Loading dataset: dclm-pubmedqa-merged
Description: DCLM和PubMedQA合并数据集，共20,000条，已统一为text字段
Loading local dataset from: /home/polyu/pcllzy/zo_withbp/datasets_subset/dclm_pubmedqa_merged
Tokenizing dataset...
Reading dataset:   0%|          | 0/20000 [00:00<?, ?it/s]Reading dataset:   0%|          | 79/20000 [00:00<00:25, 779.19it/s]Reading dataset:   1%|          | 157/20000 [00:00<00:28, 708.02it/s]Reading dataset:   1%|          | 229/20000 [00:00<00:30, 647.91it/s]Reading dataset:   2%|▏         | 301/20000 [00:00<00:29, 672.32it/s]Reading dataset:   2%|▏         | 375/20000 [00:00<00:28, 683.60it/s]Reading dataset:   2%|▏         | 444/20000 [00:00<00:31, 616.41it/s]Reading dataset:   3%|▎         | 507/20000 [00:00<00:32, 603.10it/s]Reading dataset:   3%|▎         | 569/20000 [00:00<00:32, 606.97it/s]Reading dataset:   3%|▎         | 657/20000 [00:00<00:28, 680.04it/s]Reading dataset:   4%|▎         | 726/20000 [00:01<00:30, 637.88it/s]Reading dataset:   4%|▍         | 791/20000 [00:01<00:30, 635.87it/s]Reading dataset:   4%|▍         | 866/20000 [00:01<00:28, 667.08it/s]Reading dataset:   5%|▍         | 946/20000 [00:01<00:27, 701.16it/s]Reading dataset:   5%|▌         | 1026/20000 [00:01<00:29, 639.68it/s]Reading dataset:   5%|▌         | 1092/20000 [00:01<00:29, 645.06it/s]Reading dataset:   6%|▌         | 1158/20000 [00:01<00:30, 620.81it/s]Reading dataset:   6%|▌         | 1223/20000 [00:01<00:29, 627.08it/s]Reading dataset:   6%|▋         | 1287/20000 [00:01<00:29, 625.81it/s]Reading dataset:   7%|▋         | 1351/20000 [00:02<00:33, 564.97it/s]Reading dataset:   7%|▋         | 1456/20000 [00:02<00:26, 691.87it/s]Reading dataset:   8%|▊         | 1528/20000 [00:02<00:28, 657.19it/s]Reading dataset:   8%|▊         | 1613/20000 [00:02<00:25, 707.69it/s]Reading dataset:   8%|▊         | 1686/20000 [00:02<00:26, 681.23it/s]Reading dataset:   9%|▉         | 1756/20000 [00:02<00:26, 678.57it/s]Reading dataset:   9%|▉         | 1848/20000 [00:02<00:24, 744.99it/s]Reading dataset:  10%|▉         | 1924/20000 [00:02<00:28, 644.44it/s]Reading dataset:  10%|█         | 2002/20000 [00:03<00:27, 662.11it/s]Reading dataset:  10%|█         | 2090/20000 [00:03<00:24, 718.92it/s]Reading dataset:  11%|█         | 2165/20000 [00:03<00:25, 688.55it/s]Reading dataset:  11%|█         | 2238/20000 [00:03<00:25, 696.09it/s]Reading dataset:  12%|█▏        | 2309/20000 [00:03<00:25, 692.61it/s]Reading dataset:  12%|█▏        | 2380/20000 [00:03<00:25, 690.35it/s]Reading dataset:  12%|█▏        | 2450/20000 [00:03<00:28, 606.99it/s]Reading dataset:  13%|█▎        | 2513/20000 [00:03<00:29, 593.93it/s]Reading dataset:  13%|█▎        | 2579/20000 [00:03<00:28, 605.72it/s]Reading dataset:  13%|█▎        | 2647/20000 [00:04<00:27, 624.10it/s]Reading dataset:  14%|█▎        | 2711/20000 [00:04<00:29, 584.59it/s]Reading dataset:  14%|█▍        | 2812/20000 [00:04<00:25, 674.30it/s]Reading dataset:  14%|█▍        | 2881/20000 [00:04<00:27, 620.24it/s]Reading dataset:  15%|█▍        | 2948/20000 [00:04<00:27, 629.44it/s]Reading dataset:  15%|█▌        | 3012/20000 [00:04<00:28, 601.73it/s]Reading dataset:  16%|█▌        | 3109/20000 [00:04<00:24, 698.88it/s]Reading dataset:  16%|█▌        | 3183/20000 [00:04<00:24, 682.03it/s]Reading dataset:  16%|█▋        | 3253/20000 [00:04<00:26, 629.86it/s]Reading dataset:  17%|█▋        | 3331/20000 [00:05<00:25, 665.37it/s]Reading dataset:  17%|█▋        | 3411/20000 [00:05<00:23, 700.46it/s]Reading dataset:  17%|█▋        | 3483/20000 [00:05<00:25, 644.93it/s]Reading dataset:  18%|█▊        | 3568/20000 [00:05<00:23, 698.92it/s]Reading dataset:  18%|█▊        | 3659/20000 [00:05<00:21, 750.05it/s]Reading dataset:  19%|█▊        | 3736/20000 [00:05<00:26, 611.69it/s]Reading dataset:  19%|█▉        | 3803/20000 [00:05<00:28, 568.01it/s]Reading dataset:  19%|█▉        | 3864/20000 [00:05<00:29, 554.11it/s]Reading dataset:  20%|█▉        | 3941/20000 [00:06<00:26, 600.48it/s]Reading dataset:  20%|██        | 4008/20000 [00:06<00:26, 608.22it/s]Reading dataset:  20%|██        | 4071/20000 [00:06<00:26, 592.04it/s]Reading dataset:  21%|██        | 4153/20000 [00:06<00:24, 635.62it/s]Reading dataset:  21%|██        | 4230/20000 [00:06<00:23, 666.98it/s]Reading dataset:  22%|██▏       | 4307/20000 [00:06<00:22, 695.01it/s]Reading dataset:  22%|██▏       | 4378/20000 [00:06<00:23, 654.75it/s]Reading dataset:  22%|██▏       | 4445/20000 [00:06<00:25, 611.26it/s]Reading dataset:  23%|██▎       | 4531/20000 [00:06<00:22, 677.28it/s]Reading dataset:  23%|██▎       | 4601/20000 [00:07<00:25, 594.09it/s]Reading dataset:  23%|██▎       | 4664/20000 [00:07<00:26, 586.47it/s]Reading dataset:  24%|██▎       | 4725/20000 [00:07<00:27, 548.30it/s]Reading dataset:  24%|██▍       | 4782/20000 [00:07<00:28, 542.86it/s]Reading dataset:  24%|██▍       | 4863/20000 [00:07<00:24, 613.22it/s]Reading dataset:  25%|██▍       | 4926/20000 [00:07<00:24, 608.43it/s]Reading dataset:  25%|██▍       | 4992/20000 [00:07<00:24, 621.54it/s]Reading dataset:  25%|██▌       | 5056/20000 [00:07<00:25, 589.61it/s]Reading dataset:  26%|██▌       | 5116/20000 [00:08<00:25, 582.46it/s]Reading dataset:  26%|██▌       | 5179/20000 [00:08<00:34, 431.92it/s]Reading dataset:  26%|██▌       | 5229/20000 [00:08<00:34, 433.54it/s]Reading dataset:  26%|██▋       | 5298/20000 [00:08<00:29, 494.08it/s]Reading dataset:  27%|██▋       | 5352/20000 [00:08<00:39, 367.36it/s]Reading dataset:  27%|██▋       | 5437/20000 [00:08<00:31, 459.00it/s]Reading dataset:  27%|██▋       | 5492/20000 [00:09<00:40, 356.52it/s]Reading dataset:  28%|██▊       | 5574/20000 [00:09<00:32, 441.37it/s]Reading dataset:  28%|██▊       | 5659/20000 [00:09<00:27, 526.67it/s]Reading dataset:  29%|██▊       | 5723/20000 [00:09<00:27, 523.49it/s]Reading dataset:  29%|██▉       | 5783/20000 [00:09<00:27, 523.10it/s]Reading dataset:  29%|██▉       | 5864/20000 [00:09<00:23, 593.73it/s]Reading dataset:  30%|██▉       | 5954/20000 [00:09<00:21, 666.40it/s]Reading dataset:  30%|███       | 6039/20000 [00:09<00:20, 695.13it/s]Reading dataset:  31%|███       | 6112/20000 [00:09<00:20, 677.84it/s]Reading dataset:  31%|███       | 6203/20000 [00:10<00:18, 738.85it/s]Reading dataset:  31%|███▏      | 6279/20000 [00:10<00:18, 731.98it/s]Reading dataset:  32%|███▏      | 6354/20000 [00:10<00:19, 699.07it/s]Reading dataset:  32%|███▏      | 6433/20000 [00:10<00:19, 704.40it/s]Reading dataset:  33%|███▎      | 6505/20000 [00:10<00:23, 576.72it/s]Reading dataset:  33%|███▎      | 6567/20000 [00:10<00:22, 584.26it/s]Reading dataset:  33%|███▎      | 6629/20000 [00:10<00:24, 535.83it/s]Reading dataset:  34%|███▎      | 6708/20000 [00:11<00:27, 480.62it/s]Reading dataset:  34%|███▍      | 6781/20000 [00:11<00:25, 516.62it/s]Reading dataset:  34%|███▍      | 6864/20000 [00:11<00:22, 588.97it/s]Reading dataset:  35%|███▍      | 6927/20000 [00:11<00:21, 594.61it/s]Reading dataset:  35%|███▍      | 6990/20000 [00:11<00:22, 573.33it/s]Reading dataset:  35%|███▌      | 7071/20000 [00:11<00:20, 627.20it/s]Reading dataset:  36%|███▌      | 7169/20000 [00:11<00:19, 671.91it/s]Reading dataset:  36%|███▋      | 7251/20000 [00:11<00:18, 701.81it/s]Reading dataset:  37%|███▋      | 7323/20000 [00:12<00:23, 540.30it/s]Reading dataset:  37%|███▋      | 7383/20000 [00:12<00:23, 547.98it/s]Reading dataset:  37%|███▋      | 7459/20000 [00:12<00:21, 595.96it/s]Reading dataset:  38%|███▊      | 7529/20000 [00:12<00:20, 621.28it/s]Reading dataset:  38%|███▊      | 7595/20000 [00:12<00:25, 477.30it/s]Reading dataset:  38%|███▊      | 7650/20000 [00:12<00:25, 490.86it/s]Reading dataset:  39%|███▊      | 7710/20000 [00:12<00:23, 514.72it/s]Reading dataset:  39%|███▉      | 7811/20000 [00:12<00:19, 641.00it/s]Reading dataset:  39%|███▉      | 7881/20000 [00:12<00:19, 620.30it/s]Reading dataset:  40%|███▉      | 7947/20000 [00:13<00:20, 579.13it/s]Reading dataset:  40%|████      | 8008/20000 [00:13<00:21, 570.82it/s]Reading dataset:  40%|████      | 8071/20000 [00:13<00:20, 582.14it/s]Reading dataset:  41%|████      | 8131/20000 [00:13<00:20, 581.75it/s]Reading dataset:  41%|████      | 8191/20000 [00:13<00:20, 577.60it/s]Reading dataset:  41%|████▏     | 8274/20000 [00:13<00:18, 648.22it/s]Reading dataset:  42%|████▏     | 8355/20000 [00:13<00:16, 693.90it/s]Reading dataset:  42%|████▏     | 8426/20000 [00:13<00:17, 673.64it/s]Reading dataset:  43%|████▎     | 8518/20000 [00:13<00:15, 741.90it/s]Reading dataset:  43%|████▎     | 8593/20000 [00:14<00:15, 731.96it/s]Reading dataset:  43%|████▎     | 8680/20000 [00:14<00:14, 770.57it/s]Reading dataset:  44%|████▍     | 8758/20000 [00:14<00:14, 752.71it/s]Reading dataset:  44%|████▍     | 8834/20000 [00:14<00:14, 744.72it/s]Reading dataset:  45%|████▍     | 8920/20000 [00:14<00:14, 770.44it/s]Reading dataset:  45%|████▍     | 8998/20000 [00:14<00:14, 747.48it/s]Reading dataset:  45%|████▌     | 9074/20000 [00:14<00:16, 649.61it/s]Reading dataset:  46%|████▌     | 9142/20000 [00:14<00:16, 647.64it/s]Reading dataset:  46%|████▌     | 9209/20000 [00:14<00:17, 629.43it/s]Reading dataset:  46%|████▋     | 9286/20000 [00:15<00:16, 664.59it/s]Reading dataset:  47%|████▋     | 9354/20000 [00:15<00:17, 618.21it/s]Reading dataset:  47%|████▋     | 9433/20000 [00:15<00:15, 663.40it/s]Reading dataset:  48%|████▊     | 9512/20000 [00:15<00:15, 695.80it/s]Reading dataset:  48%|████▊     | 9583/20000 [00:15<00:20, 512.54it/s]Reading dataset:  48%|████▊     | 9684/20000 [00:15<00:16, 625.12it/s]Reading dataset:  49%|████▉     | 9756/20000 [00:15<00:17, 600.13it/s]Reading dataset:  49%|████▉     | 9823/20000 [00:15<00:16, 599.48it/s]Reading dataset:  50%|████▉     | 9900/20000 [00:16<00:15, 641.96it/s]Reading dataset:  50%|████▉     | 9968/20000 [00:16<00:15, 637.93it/s]Reading dataset:  50%|█████     | 10045/20000 [00:16<00:14, 672.42it/s]Reading dataset:  51%|█████     | 10115/20000 [00:16<00:15, 618.41it/s]Reading dataset:  51%|█████     | 10180/20000 [00:16<00:16, 580.58it/s]Reading dataset:  51%|█████▏    | 10279/20000 [00:16<00:14, 686.49it/s]Reading dataset:  52%|█████▏    | 10356/20000 [00:16<00:13, 706.85it/s]Reading dataset:  52%|█████▏    | 10439/20000 [00:16<00:12, 739.86it/s]Reading dataset:  53%|█████▎    | 10515/20000 [00:16<00:14, 667.76it/s]Reading dataset:  53%|█████▎    | 10585/20000 [00:17<00:16, 558.10it/s]Reading dataset:  53%|█████▎    | 10646/20000 [00:17<00:16, 550.27it/s]Reading dataset:  54%|█████▎    | 10727/20000 [00:17<00:15, 611.09it/s]Reading dataset:  54%|█████▍    | 10792/20000 [00:17<00:15, 584.88it/s]Reading dataset:  54%|█████▍    | 10853/20000 [00:17<00:22, 403.32it/s]Reading dataset:  55%|█████▍    | 10907/20000 [00:17<00:21, 420.97it/s]Reading dataset:  55%|█████▍    | 10976/20000 [00:17<00:18, 477.09it/s]Reading dataset:  55%|█████▌    | 11031/20000 [00:18<00:19, 464.82it/s]Reading dataset:  56%|█████▌    | 11111/20000 [00:18<00:17, 508.79it/s]Reading dataset:  56%|█████▌    | 11170/20000 [00:18<00:16, 525.18it/s]Reading dataset:  56%|█████▌    | 11227/20000 [00:18<00:16, 527.52it/s]Reading dataset:  56%|█████▋    | 11288/20000 [00:18<00:16, 535.28it/s]Reading dataset:  57%|█████▋    | 11353/20000 [00:18<00:15, 561.67it/s]Reading dataset:  57%|█████▋    | 11448/20000 [00:18<00:12, 665.95it/s]Reading dataset:  58%|█████▊    | 11533/20000 [00:18<00:11, 716.46it/s]Reading dataset:  58%|█████▊    | 11610/20000 [00:18<00:11, 726.34it/s]Reading dataset:  58%|█████▊    | 11687/20000 [00:19<00:11, 734.18it/s]Reading dataset:  59%|█████▉    | 11780/20000 [00:19<00:10, 764.07it/s]Reading dataset:  59%|█████▉    | 11863/20000 [00:19<00:10, 782.14it/s]Reading dataset:  60%|█████▉    | 11942/20000 [00:19<00:10, 746.21it/s]Reading dataset:  60%|██████    | 12028/20000 [00:19<00:10, 752.72it/s]Reading dataset:  61%|██████    | 12129/20000 [00:19<00:09, 822.44it/s]Reading dataset:  61%|██████    | 12212/20000 [00:19<00:10, 725.64it/s]Reading dataset:  61%|██████▏   | 12293/20000 [00:19<00:10, 746.38it/s]Reading dataset:  62%|██████▏   | 12370/20000 [00:19<00:10, 734.71it/s]Reading dataset:  62%|██████▏   | 12445/20000 [00:20<00:10, 704.33it/s]Reading dataset:  63%|██████▎   | 12517/20000 [00:20<00:11, 664.49it/s]Reading dataset:  63%|██████▎   | 12585/20000 [00:20<00:11, 649.79it/s]Reading dataset:  63%|██████▎   | 12660/20000 [00:20<00:10, 670.27it/s]Reading dataset:  64%|██████▍   | 12751/20000 [00:20<00:09, 736.71it/s]Reading dataset:  64%|██████▍   | 12826/20000 [00:20<00:10, 696.13it/s]Reading dataset:  64%|██████▍   | 12897/20000 [00:20<00:10, 696.82it/s]Reading dataset:  65%|██████▍   | 12985/20000 [00:20<00:09, 748.36it/s]Reading dataset:  65%|██████▌   | 13085/20000 [00:20<00:08, 813.62it/s]Reading dataset:  66%|██████▌   | 13168/20000 [00:21<00:09, 700.74it/s]Reading dataset:  66%|██████▋   | 13260/20000 [00:21<00:08, 757.51it/s]Reading dataset:  67%|██████▋   | 13342/20000 [00:21<00:08, 771.05it/s]Reading dataset:  67%|██████▋   | 13422/20000 [00:21<00:09, 682.48it/s]Reading dataset:  67%|██████▋   | 13497/20000 [00:21<00:09, 697.89it/s]Reading dataset:  68%|██████▊   | 13616/20000 [00:21<00:07, 826.25it/s]Reading dataset:  69%|██████▊   | 13702/20000 [00:21<00:07, 807.21it/s]Reading dataset:  69%|██████▉   | 13785/20000 [00:21<00:09, 672.07it/s]Reading dataset:  69%|██████▉   | 13867/20000 [00:22<00:08, 708.31it/s]Reading dataset:  70%|██████▉   | 13943/20000 [00:22<00:09, 664.35it/s]Reading dataset:  70%|███████   | 14037/20000 [00:22<00:08, 731.40it/s]Reading dataset:  71%|███████   | 14114/20000 [00:22<00:08, 689.31it/s]Reading dataset:  71%|███████   | 14186/20000 [00:22<00:09, 634.13it/s]Reading dataset:  71%|███████▏  | 14252/20000 [00:22<00:09, 601.95it/s]Reading dataset:  72%|███████▏  | 14323/20000 [00:22<00:09, 627.52it/s]Reading dataset:  72%|███████▏  | 14391/20000 [00:22<00:08, 641.31it/s]Reading dataset:  72%|███████▏  | 14457/20000 [00:23<00:09, 596.57it/s]Reading dataset:  73%|███████▎  | 14534/20000 [00:23<00:08, 641.76it/s]Reading dataset:  73%|███████▎  | 14600/20000 [00:23<00:08, 619.73it/s]Reading dataset:  73%|███████▎  | 14670/20000 [00:23<00:08, 617.78it/s]Reading dataset:  74%|███████▎  | 14733/20000 [00:23<00:08, 619.42it/s]Reading dataset:  74%|███████▍  | 14802/20000 [00:23<00:08, 636.42it/s]Reading dataset:  74%|███████▍  | 14881/20000 [00:23<00:07, 676.30it/s]Reading dataset:  75%|███████▍  | 14950/20000 [00:23<00:07, 648.04it/s]Reading dataset:  75%|███████▌  | 15016/20000 [00:23<00:08, 589.68it/s]Reading dataset:  75%|███████▌  | 15079/20000 [00:24<00:08, 594.84it/s]Reading dataset:  76%|███████▌  | 15141/20000 [00:24<00:08, 599.54it/s]Reading dataset:  76%|███████▌  | 15212/20000 [00:24<00:07, 628.44it/s]Reading dataset:  76%|███████▋  | 15283/20000 [00:24<00:07, 646.74it/s]Reading dataset:  77%|███████▋  | 15349/20000 [00:24<00:08, 558.78it/s]Reading dataset:  77%|███████▋  | 15430/20000 [00:24<00:07, 605.15it/s]Reading dataset:  78%|███████▊  | 15502/20000 [00:24<00:07, 635.34it/s]Reading dataset:  78%|███████▊  | 15568/20000 [00:24<00:07, 567.86it/s]Reading dataset:  78%|███████▊  | 15640/20000 [00:24<00:07, 602.47it/s]Reading dataset:  79%|███████▊  | 15705/20000 [00:25<00:06, 614.85it/s]Reading dataset:  79%|███████▉  | 15769/20000 [00:25<00:07, 562.19it/s]Reading dataset:  79%|███████▉  | 15846/20000 [00:25<00:06, 616.42it/s]Reading dataset:  80%|███████▉  | 15910/20000 [00:25<00:06, 620.78it/s]Reading dataset:  80%|███████▉  | 15974/20000 [00:25<00:07, 531.10it/s]Reading dataset:  80%|████████  | 16031/20000 [00:25<00:07, 526.90it/s]Reading dataset:  80%|████████  | 16091/20000 [00:25<00:07, 542.03it/s]Reading dataset:  81%|████████  | 16197/20000 [00:25<00:05, 681.35it/s]Reading dataset:  81%|████████▏ | 16272/20000 [00:25<00:05, 697.49it/s]Reading dataset:  82%|████████▏ | 16357/20000 [00:26<00:04, 740.01it/s]Reading dataset:  82%|████████▏ | 16433/20000 [00:26<00:05, 653.45it/s]Reading dataset:  83%|████████▎ | 16516/20000 [00:26<00:04, 699.95it/s]Reading dataset:  83%|████████▎ | 16589/20000 [00:26<00:06, 498.27it/s]Reading dataset:  83%|████████▎ | 16649/20000 [00:26<00:06, 506.26it/s]Reading dataset:  84%|████████▎ | 16717/20000 [00:26<00:06, 545.75it/s]Reading dataset:  84%|████████▍ | 16782/20000 [00:26<00:05, 569.66it/s]Reading dataset:  84%|████████▍ | 16848/20000 [00:26<00:05, 586.24it/s]Reading dataset:  85%|████████▍ | 16924/20000 [00:27<00:04, 632.14it/s]Reading dataset:  85%|████████▍ | 16993/20000 [00:27<00:04, 621.99it/s]Reading dataset:  85%|████████▌ | 17058/20000 [00:27<00:05, 570.05it/s]Reading dataset:  86%|████████▌ | 17122/20000 [00:27<00:04, 586.61it/s]Reading dataset:  86%|████████▌ | 17192/20000 [00:27<00:04, 572.63it/s]Reading dataset:  86%|████████▋ | 17259/20000 [00:27<00:04, 574.45it/s]Reading dataset:  87%|████████▋ | 17335/20000 [00:27<00:04, 622.24it/s]Reading dataset:  87%|████████▋ | 17409/20000 [00:27<00:03, 653.74it/s]Reading dataset:  87%|████████▋ | 17476/20000 [00:27<00:04, 620.73it/s]Reading dataset:  88%|████████▊ | 17540/20000 [00:28<00:04, 607.25it/s]Reading dataset:  88%|████████▊ | 17602/20000 [00:28<00:03, 601.68it/s]Reading dataset:  89%|████████▊ | 17702/20000 [00:28<00:03, 712.54it/s]Reading dataset:  89%|████████▉ | 17789/20000 [00:28<00:03, 712.04it/s]Reading dataset:  89%|████████▉ | 17861/20000 [00:28<00:03, 665.39it/s]Reading dataset:  90%|████████▉ | 17933/20000 [00:28<00:03, 679.07it/s]Reading dataset:  90%|█████████ | 18002/20000 [00:28<00:03, 606.32it/s]Reading dataset:  90%|█████████ | 18084/20000 [00:28<00:02, 658.69it/s]Reading dataset:  91%|█████████ | 18166/20000 [00:29<00:02, 695.99it/s]Reading dataset:  91%|█████████ | 18238/20000 [00:29<00:02, 660.26it/s]Reading dataset:  92%|█████████▏| 18306/20000 [00:29<00:02, 643.80it/s]Reading dataset:  92%|█████████▏| 18377/20000 [00:29<00:02, 650.25it/s]Reading dataset:  92%|█████████▏| 18444/20000 [00:29<00:02, 654.72it/s]Reading dataset:  93%|█████████▎| 18510/20000 [00:29<00:02, 611.99it/s]Reading dataset:  93%|█████████▎| 18610/20000 [00:29<00:01, 718.05it/s]Reading dataset:  93%|█████████▎| 18694/20000 [00:29<00:01, 746.82it/s]Reading dataset:  94%|█████████▍| 18779/20000 [00:29<00:01, 774.80it/s]Reading dataset:  94%|█████████▍| 18858/20000 [00:29<00:01, 768.89it/s]Reading dataset:  95%|█████████▍| 18936/20000 [00:30<00:01, 760.31it/s]Reading dataset:  95%|█████████▌| 19013/20000 [00:30<00:01, 737.89it/s]Reading dataset:  95%|█████████▌| 19088/20000 [00:30<00:01, 665.42it/s]Reading dataset:  96%|█████████▌| 19178/20000 [00:30<00:01, 727.90it/s]Reading dataset:  96%|█████████▋| 19253/20000 [00:30<00:01, 621.10it/s]Reading dataset:  97%|█████████▋| 19347/20000 [00:30<00:00, 700.86it/s]Reading dataset:  97%|█████████▋| 19422/20000 [00:30<00:00, 711.01it/s]Reading dataset:  97%|█████████▋| 19497/20000 [00:30<00:00, 683.52it/s]Reading dataset:  98%|█████████▊| 19569/20000 [00:31<00:00, 689.46it/s]Reading dataset:  98%|█████████▊| 19683/20000 [00:31<00:00, 812.34it/s]Reading dataset:  99%|█████████▉| 19767/20000 [00:31<00:00, 531.64it/s]Reading dataset:  99%|█████████▉| 19837/20000 [00:31<00:00, 560.85it/s]Reading dataset: 100%|█████████▉| 19917/20000 [00:31<00:00, 614.88it/s]Reading dataset: 100%|█████████▉| 19992/20000 [00:31<00:00, 645.72it/s]Reading dataset: 100%|██████████| 20000/20000 [00:31<00:00, 629.81it/s]
Creating blocks of size 128...
Dataset prepared. Total blocks: 108693
Saving dataset to cache: cache/dataset_dclm-pubmedqa-merged_bs128_samplesNone.pkl
BP batch size: 2 (different from training batch size: 1)
ZO query batch size: 2 (different from training batch size: 1)
Splitting dataset for BP and ZO (non-overlapping)...
Dataset split: BP subset = 54346 samples, ZO subset = 54347 samples
Creating BP dataloader from split subset, batch_size: 2
Training scope: full model.
Trainable parameters: 124.44M (100.00% of total)
ZO queries will use fresh data batches per direction from split subset (non-overlapping with BP).
BP will use separate dataset: None
Using optimizer: MuDaMW
Epoch 1/2:   0%|          | 0/108693 [00:00<?, ?it/s][Instruct] Summary: avg_rank=8274676.0, avg_cosine_similarity=0.917096, total_time=3.5509s
Epoch 1/2:   0%|          | 0/108693 [00:04<?, ?it/s, loss=10.9603, grad_norm=1418.8619, opt=mudamw, queries=64, bp_int=1]Epoch 1/2:   0%|          | 1/108693 [00:04<146:05:27,  4.84s/it, loss=10.9603, grad_norm=1418.8619, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=8020013.0, avg_cosine_similarity=0.905614, total_time=3.4744s
Epoch 1/2:   0%|          | 1/108693 [00:08<146:05:27,  4.84s/it, loss=10.7029, grad_norm=1357.4263, opt=mudamw, queries=64, bp_int=1]Epoch 1/2:   0%|          | 2/108693 [00:08<129:27:37,  4.29s/it, loss=10.7029, grad_norm=1357.4263, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=8388608.0, avg_cosine_similarity=0.929574, total_time=3.9625s
Epoch 1/2:   0%|          | 2/108693 [00:13<129:27:37,  4.29s/it, loss=10.6108, grad_norm=1016.4843, opt=mudamw, queries=64, bp_int=1]Epoch 1/2:   0%|          | 3/108693 [00:13<130:48:17,  4.33s/it, loss=10.6108, grad_norm=1016.4843, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=8388608.0, avg_cosine_similarity=0.929931, total_time=3.9611s
Epoch 1/2:   0%|          | 3/108693 [00:17<130:48:17,  4.33s/it, loss=10.4533, grad_norm=917.2175, opt=mudamw, queries=64, bp_int=1] Epoch 1/2:   0%|          | 4/108693 [00:17<131:27:33,  4.35s/it, loss=10.4533, grad_norm=917.2175, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=8388608.0, avg_cosine_similarity=0.929619, total_time=3.9655s
Epoch 1/2:   0%|          | 4/108693 [00:21<131:27:33,  4.35s/it, loss=10.2462, grad_norm=481.8171, opt=mudamw, queries=64, bp_int=1]Epoch 1/2:   0%|          | 5/108693 [00:21<131:51:19,  4.37s/it, loss=10.2462, grad_norm=481.8171, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=8388608.0, avg_cosine_similarity=0.929287, total_time=3.9613s
Epoch 1/2:   0%|          | 5/108693 [00:26<131:51:19,  4.37s/it, loss=10.2658, grad_norm=346.5587, opt=mudamw, queries=64, bp_int=1]Epoch 1/2:   0%|          | 6/108693 [00:26<132:00:22,  4.37s/it, loss=10.2658, grad_norm=346.5587, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=8388608.0, avg_cosine_similarity=0.933816, total_time=3.9431s
Epoch 1/2:   0%|          | 6/108693 [00:30<132:00:22,  4.37s/it, loss=10.4731, grad_norm=287.7776, opt=mudamw, queries=64, bp_int=1]Epoch 1/2:   0%|          | 7/108693 [00:30<131:57:05,  4.37s/it, loss=10.4731, grad_norm=287.7776, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=8388608.0, avg_cosine_similarity=0.934916, total_time=3.9550s
Epoch 1/2:   0%|          | 7/108693 [00:35<131:57:05,  4.37s/it, loss=10.1341, grad_norm=286.1163, opt=mudamw, queries=64, bp_int=1]Epoch 1/2:   0%|          | 8/108693 [00:35<132:03:14,  4.37s/it, loss=10.1341, grad_norm=286.1163, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=8388608.0, avg_cosine_similarity=0.934824, total_time=3.9413s
Epoch 1/2:   0%|          | 8/108693 [00:39<132:03:14,  4.37s/it, loss=10.1126, grad_norm=208.6644, opt=mudamw, queries=64, bp_int=1]Epoch 1/2:   0%|          | 9/108693 [00:39<131:56:11,  4.37s/it, loss=10.1126, grad_norm=208.6644, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=8388608.0, avg_cosine_similarity=0.935084, total_time=3.9376s
Epoch 1/2:   0%|          | 9/108693 [00:45<131:56:11,  4.37s/it, loss=10.1429, grad_norm=179.9150, opt=mudamw, queries=64, bp_int=1]Epoch 1/2:   0%|          | 10/108693 [00:45<149:59:25,  4.97s/it, loss=10.1429, grad_norm=179.9150, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=8388608.0, avg_cosine_similarity=0.935325, total_time=3.9303s
Epoch 1/2:   0%|          | 10/108693 [00:50<149:59:25,  4.97s/it, loss=10.1173, grad_norm=206.4031, opt=mudamw, queries=64, bp_int=1]Epoch 1/2:   0%|          | 11/108693 [00:50<144:17:30,  4.78s/it, loss=10.1173, grad_norm=206.4031, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=8388608.0, avg_cosine_similarity=0.935765, total_time=3.9343s
Epoch 1/2:   0%|          | 11/108693 [00:54<144:17:30,  4.78s/it, loss=10.0885, grad_norm=149.4316, opt=mudamw, queries=64, bp_int=1]Epoch 1/2:   0%|          | 12/108693 [00:54<140:19:17,  4.65s/it, loss=10.0885, grad_norm=149.4316, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=8388608.0, avg_cosine_similarity=0.934725, total_time=3.9352s
Epoch 1/2:   0%|          | 12/108693 [00:58<140:19:17,  4.65s/it, loss=10.2292, grad_norm=110.0168, opt=mudamw, queries=64, bp_int=1]Epoch 1/2:   0%|          | 13/108693 [00:58<137:40:22,  4.56s/it, loss=10.2292, grad_norm=110.0168, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=8388608.0, avg_cosine_similarity=0.933627, total_time=3.9491s
Epoch 1/2:   0%|          | 13/108693 [01:03<137:40:22,  4.56s/it, loss=10.0454, grad_norm=66.1289, opt=mudamw, queries=64, bp_int=1] Epoch 1/2:   0%|          | 14/108693 [01:03<135:52:48,  4.50s/it, loss=10.0454, grad_norm=66.1289, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=8388608.0, avg_cosine_similarity=0.936084, total_time=3.9343s
Epoch 1/2:   0%|          | 14/108693 [01:07<135:52:48,  4.50s/it, loss=10.0280, grad_norm=111.4361, opt=mudamw, queries=64, bp_int=1]Epoch 1/2:   0%|          | 15/108693 [01:07<134:32:43,  4.46s/it, loss=10.0280, grad_norm=111.4361, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=8388608.0, avg_cosine_similarity=0.936138, total_time=3.9279s
Epoch 1/2:   0%|          | 15/108693 [01:11<134:32:43,  4.46s/it, loss=9.9135, grad_norm=83.3534, opt=mudamw, queries=64, bp_int=1]  Epoch 1/2:   0%|          | 16/108693 [01:11<133:35:47,  4.43s/it, loss=9.9135, grad_norm=83.3534, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=8388608.0, avg_cosine_similarity=0.944687, total_time=4.3460s
Epoch 1/2:   0%|          | 16/108693 [01:16<133:35:47,  4.43s/it, loss=9.6317, grad_norm=58.3181, opt=mudamw, queries=64, bp_int=1]Epoch 1/2:   0%|          | 17/108693 [01:16<136:44:43,  4.53s/it, loss=9.6317, grad_norm=58.3181, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=7964034.0, avg_cosine_similarity=0.915439, total_time=3.8738s
Epoch 1/2:   0%|          | 17/108693 [01:20<136:44:43,  4.53s/it, loss=9.9578, grad_norm=76.0633, opt=mudamw, queries=64, bp_int=1]Epoch 1/2:   0%|          | 18/108693 [01:20<134:37:05,  4.46s/it, loss=9.9578, grad_norm=76.0633, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=7865754.0, avg_cosine_similarity=0.910581, total_time=3.8636s
Epoch 1/2:   0%|          | 18/108693 [01:25<134:37:05,  4.46s/it, loss=10.0918, grad_norm=60.4925, opt=mudamw, queries=64, bp_int=1]Epoch 1/2:   0%|          | 19/108693 [01:25<133:06:13,  4.41s/it, loss=10.0918, grad_norm=60.4925, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=7906476.0, avg_cosine_similarity=0.912550, total_time=3.8742s
Epoch 1/2:   0%|          | 19/108693 [01:31<133:06:13,  4.41s/it, loss=9.9150, grad_norm=51.1321, opt=mudamw, queries=64, bp_int=1] Epoch 1/2:   0%|          | 20/108693 [01:31<149:59:43,  4.97s/it, loss=9.9150, grad_norm=51.1321, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=7932253.0, avg_cosine_similarity=0.913676, total_time=3.8792s
Epoch 1/2:   0%|          | 20/108693 [01:35<149:59:43,  4.97s/it, loss=9.6650, grad_norm=57.4387, opt=mudamw, queries=64, bp_int=1]Epoch 1/2:   0%|          | 21/108693 [01:35<143:58:26,  4.77s/it, loss=9.6650, grad_norm=57.4387, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=8388608.0, avg_cosine_similarity=0.942407, total_time=4.3472s
Epoch 1/2:   0%|          | 21/108693 [01:40<143:58:26,  4.77s/it, loss=9.6255, grad_norm=62.4196, opt=mudamw, queries=64, bp_int=1]Epoch 1/2:   0%|          | 22/108693 [01:40<143:59:12,  4.77s/it, loss=9.6255, grad_norm=62.4196, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=8388608.0, avg_cosine_similarity=0.943970, total_time=4.3428s
Epoch 1/2:   0%|          | 22/108693 [01:45<143:59:12,  4.77s/it, loss=9.9260, grad_norm=90.2499, opt=mudamw, queries=64, bp_int=1]Epoch 1/2:   0%|          | 23/108693 [01:45<143:59:39,  4.77s/it, loss=9.9260, grad_norm=90.2499, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=7846383.0, avg_cosine_similarity=0.909573, total_time=3.8524s
Epoch 1/2:   0%|          | 23/108693 [01:49<143:59:39,  4.77s/it, loss=9.8937, grad_norm=39.9534, opt=mudamw, queries=64, bp_int=1]Epoch 1/2:   0%|          | 24/108693 [01:49<139:30:51,  4.62s/it, loss=9.8937, grad_norm=39.9534, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=8388608.0, avg_cosine_similarity=0.942838, total_time=4.3512s
Epoch 1/2:   0%|          | 24/108693 [01:54<139:30:51,  4.62s/it, loss=10.0122, grad_norm=37.1872, opt=mudamw, queries=64, bp_int=1]Epoch 1/2:   0%|          | 25/108693 [01:54<140:54:35,  4.67s/it, loss=10.0122, grad_norm=37.1872, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=8388608.0, avg_cosine_similarity=0.942225, total_time=4.3430s
Epoch 1/2:   0%|          | 25/108693 [01:59<140:54:35,  4.67s/it, loss=10.0236, grad_norm=30.2791, opt=mudamw, queries=64, bp_int=1]Epoch 1/2:   0%|          | 26/108693 [01:59<141:49:11,  4.70s/it, loss=10.0236, grad_norm=30.2791, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=8388608.0, avg_cosine_similarity=0.944680, total_time=4.3297s
Epoch 1/2:   0%|          | 26/108693 [02:03<141:49:11,  4.70s/it, loss=9.5560, grad_norm=48.3950, opt=mudamw, queries=64, bp_int=1] Epoch 1/2:   0%|          | 27/108693 [02:03<142:18:49,  4.71s/it, loss=9.5560, grad_norm=48.3950, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=8388608.0, avg_cosine_similarity=0.943473, total_time=4.3460s
Epoch 1/2:   0%|          | 27/108693 [02:08<142:18:49,  4.71s/it, loss=9.8238, grad_norm=37.7024, opt=mudamw, queries=64, bp_int=1]Epoch 1/2:   0%|          | 28/108693 [02:08<142:48:36,  4.73s/it, loss=9.8238, grad_norm=37.7024, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=8034410.3, avg_cosine_similarity=0.932363, total_time=4.5270s
Epoch 1/2:   0%|          | 28/108693 [02:13<142:48:36,  4.73s/it, loss=9.6609, grad_norm=159.7920, opt=mudamw, queries=64, bp_int=1]Epoch 1/2:   0%|          | 29/108693 [02:13<144:48:24,  4.80s/it, loss=9.6609, grad_norm=159.7920, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=8388608.0, avg_cosine_similarity=0.944195, total_time=4.3504s
Epoch 1/2:   0%|          | 29/108693 [02:20<144:48:24,  4.80s/it, loss=9.5739, grad_norm=41.4945, opt=mudamw, queries=64, bp_int=1] Epoch 1/2:   0%|          | 30/108693 [02:20<162:26:02,  5.38s/it, loss=9.5739, grad_norm=41.4945, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=8388608.0, avg_cosine_similarity=0.944602, total_time=4.3317s
Epoch 1/2:   0%|          | 30/108693 [02:25<162:26:02,  5.38s/it, loss=9.7200, grad_norm=32.6460, opt=mudamw, queries=64, bp_int=1]Epoch 1/2:   0%|          | 31/108693 [02:25<156:48:03,  5.19s/it, loss=9.7200, grad_norm=32.6460, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=8085217.0, avg_cosine_similarity=0.929942, total_time=4.3667s
Epoch 1/2:   0%|          | 31/108693 [02:29<156:48:03,  5.19s/it, loss=9.3329, grad_norm=41.2396, opt=mudamw, queries=64, bp_int=1]Epoch 1/2:   0%|          | 32/108693 [02:29<153:07:10,  5.07s/it, loss=9.3329, grad_norm=41.2396, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=8388608.0, avg_cosine_similarity=0.943975, total_time=4.4263s
Epoch 1/2:   0%|          | 32/108693 [02:34<153:07:10,  5.07s/it, loss=9.8200, grad_norm=27.3683, opt=mudamw, queries=64, bp_int=1]Epoch 1/2:   0%|          | 33/108693 [02:34<151:06:53,  5.01s/it, loss=9.8200, grad_norm=27.3683, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=8240624.0, avg_cosine_similarity=0.938082, total_time=4.3821s
Epoch 1/2:   0%|          | 33/108693 [02:39<151:06:53,  5.01s/it, loss=9.5201, grad_norm=48.9847, opt=mudamw, queries=64, bp_int=1]Epoch 1/2:   0%|          | 34/108693 [02:39<149:20:43,  4.95s/it, loss=9.5201, grad_norm=48.9847, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=8037632.0, avg_cosine_similarity=0.927703, total_time=4.3322s
Epoch 1/2:   0%|          | 34/108693 [02:44<149:20:43,  4.95s/it, loss=9.2908, grad_norm=58.5378, opt=mudamw, queries=64, bp_int=1]Epoch 1/2:   0%|          | 35/108693 [02:44<147:39:23,  4.89s/it, loss=9.2908, grad_norm=58.5378, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=8388608.0, avg_cosine_similarity=0.944097, total_time=4.4151s
Epoch 1/2:   0%|          | 35/108693 [02:49<147:39:23,  4.89s/it, loss=9.8391, grad_norm=27.6091, opt=mudamw, queries=64, bp_int=1]Epoch 1/2:   0%|          | 36/108693 [02:49<147:20:05,  4.88s/it, loss=9.8391, grad_norm=27.6091, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=8388608.0, avg_cosine_similarity=0.944098, total_time=4.4241s
Epoch 1/2:   0%|          | 36/108693 [02:54<147:20:05,  4.88s/it, loss=9.7281, grad_norm=32.4347, opt=mudamw, queries=64, bp_int=1]Epoch 1/2:   0%|          | 37/108693 [02:54<147:05:01,  4.87s/it, loss=9.7281, grad_norm=32.4347, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=8106484.0, avg_cosine_similarity=0.931108, total_time=4.3170s
Epoch 1/2:   0%|          | 37/108693 [02:58<147:05:01,  4.87s/it, loss=9.4390, grad_norm=28.2776, opt=mudamw, queries=64, bp_int=1]Epoch 1/2:   0%|          | 38/108693 [02:58<145:54:02,  4.83s/it, loss=9.4390, grad_norm=28.2776, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=8210097.0, avg_cosine_similarity=0.937132, total_time=4.3366s
Epoch 1/2:   0%|          | 38/108693 [03:03<145:54:02,  4.83s/it, loss=10.0105, grad_norm=43.1105, opt=mudamw, queries=64, bp_int=1]Epoch 1/2:   0%|          | 39/108693 [03:03<145:15:02,  4.81s/it, loss=10.0105, grad_norm=43.1105, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=8189727.0, avg_cosine_similarity=0.935125, total_time=4.3309s
Epoch 1/2:   0%|          | 39/108693 [03:10<145:15:02,  4.81s/it, loss=9.2761, grad_norm=37.1461, opt=mudamw, queries=64, bp_int=1] Epoch 1/2:   0%|          | 40/108693 [03:10<162:57:27,  5.40s/it, loss=9.2761, grad_norm=37.1461, opt=mudamw, queries=64, bp_int=1][Instruct] Summary: avg_rank=7667653.0, avg_cosine_similarity=0.909006, total_time=4.2781s
Epoch 1/2:   0%|          | 40/108693 [03:15<162:57:27,  5.40s/it, loss=9.6771, grad_norm=56.0834, opt=mudamw, queries=64, bp_int=1]Epoch 1/2:   0%|          | 41/108693 [03:15<156:40:24,  5.19s/it, loss=9.6771, grad_norm=56.0834, opt=mudamw, queries=64, bp_int=1]